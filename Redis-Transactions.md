# redis transactions(redis äº‹åŠ¡)

## äº‹åŠ¡ä»‹ç»
- redis äº‹åŠ¡æ˜¯é€šè¿‡ `MULTI`, `EXEC`, `DISCARD`, `WATCH` è¿™å››ä¸ªå‘½ä»¤æ¥å®Œæˆ
- redis çš„å•ä¸ªå‘½ä»¤éƒ½æ˜¯`åŽŸå­æ€§`çš„ï¼Œæ‰€ä»¥è¿™é‡Œç¡®ä¿äº‹åŠ¡æ€§çš„å¯¹è±¡æ˜¯`å‘½ä»¤é›†åˆ`ã€‚
- redis å°†å‘½ä»¤é›†åˆåºåˆ—åŒ–å¹¶ç¡®ä¿å¤„äºŽä¸€äº‹åŠ¡çš„`å‘½ä»¤é›†åˆè¿žç»­ä¸”ä¸è¢«æ‰“æ–­`çš„æ‰§è¡Œã€‚
- redis `ä¸æ”¯æŒå›žæ»š`æ“ä½œã€‚

## ç›¸å…³å‘½ä»¤
- MULTI

    `ç”¨äºŽæ ‡è®°äº‹åŠ¡å—çš„å¼€å§‹`ã€‚

    redis ä¼šå°†åŽç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽä½¿ç”¨ `EXEC`å‘½ä»¤åŽŸå­åŒ–çš„æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åºåˆ—ã€‚

    è¯­æ³•ï¼š`MULTI`

- EXEC

    åœ¨ä¸€ä¸ª`äº‹åŠ¡ä¸­æ‰§è¡Œæ‰€æœ‰å…ˆå‰æ”¾å…¥é˜Ÿåˆ—çš„å‘½ä»¤`ï¼Œç„¶åŽæ¢å¤æ­£å¸¸çš„è¿žæŽ¥çŠ¶æ€ã€‚

    è¯­æ³•ï¼š`EXEC`

- DISCARD

    æ¸…é™¤æ‰€æœ‰å…ˆå‰åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ”¾å…¥é˜Ÿåˆ—çš„å‘½ä»¤ï¼Œç„¶åŽæ¢å¤æ­£å¸¸çš„è¿žæŽ¥çŠ¶æ€ã€‚

    è¯­æ³•ï¼š`DISCARD`

- WATCH

    å½“`äº‹åŠ¡éœ€è¦æŒ‰æ¡ä»¶æ‰§è¡Œ`æ—¶ï¼Œå°±è¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°†ç»™å®šçš„`é”®( key )è®¾ç½®ä¸ºå—ç›‘æŽ§`çš„`çŠ¶æ€`ã€‚

    è¯­æ³•ï¼š`WATCH key [â€¦]`

ä¸‹é¢è¿™æ®µä»£ç æ¥æºäºŽ [rediså®˜ç½‘](https://redis.io/topics/transactions)

æ›´å¤šä»£ç ä¹Ÿè¯·ç‚¹å‡»ä¸Šé¢ðŸ‘†é“¾æŽ¥æŸ¥é˜…

```
> MULTI
OK
> INCR foo
QUEUED
> INCR bar
QUEUED
> EXEC
1) (integer) 1
2) (integer) 1

```
åŠ ä¸Š WATCHï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ï¼Œæ²¡æœ‰å…¶ä»– redis è¿žæŽ¥å¯¹ ç›‘å¬çš„è¿™ä¸ª key è¿›è¡Œä¿®æ”¹ã€‚åˆ™ä»£ç å¦‚ä¸‹
```
> WATCH k1
OK
> MULTI
OK
> SET k1 v1
QUEUED
> SET k2 v2
QUEUED
> EXEC
1) (integer) 1
2) (integer) 1

```
åŠ ä¸Š WATCHï¼Œå¦‚æžœåœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ï¼Œæœ‰å…¶ä»–redisè¿žæŽ¥å¯¹ç›‘å¬çš„è¿™ä¸ª key è¿›è¡Œä¿®æ”¹ å¦‚ï¼š`SET k1 111`ã€‚åˆ™æ‰§è¡Œç»“æžœå¦‚ä¸‹
```
> WATCH k1
OK
> MULTI
OK
> SET k1 v1
QUEUED
> SET k2 v2
QUEUED
> EXEC
(nil)
```
